{"version":3,"sources":["../../../../src/modules/ws/messages/message.gateway.ts"],"sourcesContent":["import {\n  ConnectedSocket,\n  MessageBody,\n  SubscribeMessage,\n  WebSocketGateway,\n  WebSocketServer,\n} from \"@nestjs/websockets\";\nimport { UseGuards } from \"@nestjs/common\";\n\nimport { MessageService } from \"./message.service\";\nimport { CurrentUserId } from \"../decorators\";\nimport { WsGuard } from \"../ws.guard\";\n\nimport type { Server, Socket } from \"socket.io\";\nimport { SUBSCRIPTIONS } from \"./message.constants\";\nimport { CreateMessageDto } from \"./message.types\";\n\n@WebSocketGateway()\nexport class ChatGateway {\n  @WebSocketServer()\n  server: Server;\n\n  constructor(private readonly messageService: MessageService) {}\n\n  @UseGuards(WsGuard)\n  @SubscribeMessage(SUBSCRIPTIONS[\"send message\"])\n  async connect(\n    @ConnectedSocket()\n    socket: Socket,\n    @CurrentUserId()\n    userId: string,\n    @MessageBody()\n    data: CreateMessageDto,\n  ) {\n    const message = await this.messageService.createMessage(userId, data);\n    socket.to(message.roomId).emit(\"messages\", message);\n    //notification service here to add the notification at the create message level\n  }\n}\n"],"names":["ChatGateway","connect","socket","userId","data","message","messageService","createMessage","to","roomId","emit","constructor","server","WebSocketServer","UseGuards","WsGuard","SubscribeMessage","SUBSCRIPTIONS","ConnectedSocket","CurrentUserId","MessageBody","WebSocketGateway"],"mappings":";;;;+BAkBaA;;;eAAAA;;;4BAZN;wBACmB;gCAEK;4BACD;yBACN;kCAGM;8BACG;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAGpBA,cAAN;IAML,MAEMC,QACJ,AACAC,MAAc,EACd,AACAC,MAAc,EACd,AACAC,IAAsB,EACtB;QACA,MAAMC,UAAU,MAAM,IAAI,CAACC,cAAc,CAACC,aAAa,CAACJ,QAAQC;QAChEF,OAAOM,EAAE,CAACH,QAAQI,MAAM,EAAEC,IAAI,CAAC,YAAYL;IAC3C,+EAA+E;IACjF;IAfAM,YAA6BL,eAAgC;+BAAhCA;QAH7B,uBACAM,UADA,KAAA;8BAG6BN;IAAiC;AAgBhE;;IAnBGO,IAAAA,2BAAe;uCACR,kCAAA;GAFGb;;IAMVc,IAAAA,iBAAS,EAACC,gBAAO;IACjBC,IAAAA,4BAAgB,EAACC,+BAAa,CAAC,eAAe;IAE5CC,aAAAA,IAAAA,2BAAe;IAEfC,aAAAA,IAAAA,yBAAa;IAEbC,aAAAA,IAAAA,uBAAW;;;eAHJ,kCAAA;;eAIF,8BAAgB,4BAAhB,8BAAgB;;GAdbpB;AAAAA;IADZqB,IAAAA,4BAAgB;;;eAK8B,8BAAc,4BAAd,8BAAc;;GAJhDrB"}
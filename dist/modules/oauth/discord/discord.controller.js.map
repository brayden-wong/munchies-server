{"version":3,"sources":["../../../../src/modules/oauth/discord/discord.controller.ts"],"sourcesContent":["import { Public, ROUTES, CurrentUser } from \"@/utils\";\nimport { Controller, Get, Inject, Res, UseGuards } from \"@nestjs/common\";\nimport { DiscordOAuthGuard } from \"./discord.oauth.guard\";\nimport { DiscordProfile } from \"./discord.types\";\nimport { DiscordService } from \"./discord.service\";\nimport { type Response } from \"express\";\nimport { ConfigService } from \"@nestjs/config\";\n\n@Controller(ROUTES.DISCORD)\nexport class DiscordController {\n  constructor(\n    @Inject(ConfigService)\n    private readonly config: ConfigService,\n    private readonly discordService: DiscordService,\n  ) {}\n\n  @Public()\n  @UseGuards(DiscordOAuthGuard)\n  @Get()\n  async discordLogin() {\n    return { message: \"login\" };\n  }\n\n  @Public()\n  @UseGuards(DiscordOAuthGuard)\n  @Get(\"callback\")\n  async callback(@Res() res: Response, @CurrentUser() user: DiscordProfile) {\n    const result = await this.discordService.createProfile(user);\n    console.log(result);\n\n    const queryParams = `?at=${result.auth.at}&rt=${result.auth.rt}&id=${result.auth.session.userId}`;\n\n    return res\n      .status(200)\n      .redirect(\n        `${this.config.get(\"APP_URL\")}/--/screens/login/login${queryParams}`,\n      );\n  }\n}\n"],"names":["DiscordController","discordLogin","message","callback","res","user","result","discordService","createProfile","console","log","queryParams","auth","at","rt","session","userId","status","redirect","config","get","constructor","Public","UseGuards","DiscordOAuthGuard","Get","Res","CurrentUser","Controller","ROUTES","DISCORD","Inject","ConfigService"],"mappings":";;;;+BASaA;;;eAAAA;;;uBAT+B;wBACY;mCACtB;8BACH;gCACA;wBAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAGjBA,oBAAN;IAOL,MAGMC,eAAe;QACnB,OAAO;YAAEC,SAAS;QAAQ;IAC5B;IAEA,MAGMC,SAAS,AAAOC,GAAa,EAAE,AAAeC,IAAoB,EAAE;QACxE,MAAMC,SAAS,MAAM,IAAI,CAACC,cAAc,CAACC,aAAa,CAACH;QACvDI,QAAQC,GAAG,CAACJ;QAEZ,MAAMK,cAAc,CAAC,IAAI,EAAEL,OAAOM,IAAI,CAACC,EAAE,CAAC,IAAI,EAAEP,OAAOM,IAAI,CAACE,EAAE,CAAC,IAAI,EAAER,OAAOM,IAAI,CAACG,OAAO,CAACC,MAAM,CAAC,CAAC;QAEjG,OAAOZ,IACJa,MAAM,CAAC,KACPC,QAAQ,CACP,CAAC,EAAE,IAAI,CAACC,MAAM,CAACC,GAAG,CAAC,WAAW,uBAAuB,EAAET,YAAY,CAAC;IAE1E;IA3BAU,YAEmBF,QACAZ,eACjB;+BAFiBY;+BACAZ;sBADAY;8BACAZ;IAChB;AAwBL;;IAtBGe,IAAAA,aAAM;IACNC,IAAAA,iBAAS,EAACC,oCAAiB;IAC3BC,IAAAA,WAAG;;;GATOzB;;IAcVsB,IAAAA,aAAM;IACNC,IAAAA,iBAAS,EAACC,oCAAiB;IAC3BC,IAAAA,WAAG,EAAC;IACWC,aAAAA,IAAAA,WAAG;IAAmBC,aAAAA,IAAAA,kBAAW;;;eAAtB,oCAAA;eAA+B,4BAAc,4BAAd,4BAAc;;GAjB7D3B;AAAAA;IADZ4B,IAAAA,kBAAU,EAACC,aAAM,CAACC,OAAO;IAGrBC,aAAAA,IAAAA,cAAM,EAACC,qBAAa;;;eACI,qBAAa,4BAAb,qBAAa;eACL,8BAAc,4BAAd,8BAAc;;GAJtChC"}